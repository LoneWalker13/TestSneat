@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer


@{
    ViewData["Title"] = "Memberships";
}

<div class="modal fade" id="membershipModal" role="dialog" tabindex="-1" aria-hidden="true"></div>
<div class="row">
    <!-- Basic Layout -->
    <div class="col-xxl">
        <div class="card mb-2">
            <div class="card-header d-flex align-items-center justify-content-between">
                <h5 class="mb-0">@Localizer.GetString("Membership")</h5> <small class="text-muted float-end"><button type="button" onclick="AddMemberShips()" class="btn btn-primary"><i class="bx bx-plus"></i> &nbsp @Localizer.GetString("AddMembership")</button></small>
            </div>
            <div class="card-body">
                  <div class="row mb-2">
                      <label class="col-sm-2 col-form-label" for="basic-default-name">@Localizer.GetString("Rank") :</label>
                      <div class="col-sm-3">
                          <input type="text" class="form-control" id="searchString" />
                      </div>
                  </div>
                  <div class="row float-end" >
                      <small class="text-muted float-end"><button type="button" id="btnsearch" class="btn btn-info">@Localizer.GetString("Search")</button></small>
                  </div>
            </div>
        </div>
    </div>
</div>

<!-- Basic Bootstrap Table -->
<div class="card">
    <div class="text-nowrap table-striped table-responsive-sm">
        <table id="MydataTableDiv" class="table">
            <thead>
                <tr>
                    <th>@Localizer.GetString("Rank")</th>
                    <th>@Localizer.GetString("Tier")</th>
                    <th>@Localizer.GetString("Status")</th>
                    <th>@Localizer.GetString("Actions")</th>
                    <th style="display:none">@Localizer.GetString("Id")</th>
                </tr>
            </thead>
        </table>
    </div>
</div>
<!--/ Basic Bootstrap Table -->
@section modal {

}

@section PageScripts{
  <script>
        var globalTableData = [];
        $('#membershipModal').on('hidden.bs.modal', function () {
            // Reset form fields
            $(this).find('form').trigger('reset');
        });

        function AddMemberShips(){
            Site.AjaxGet("/Memberships/AddMemberships",
                function (data) {
                    $('#membershipModal').html(data);
                    $('#membershipModal').modal('show');
                });

        }

        function EditMemberShips(membershipId) {
            Site.AjaxGet("/Memberships/EditMemberships/" + membershipId,
                function (data) {
                    $('#membershipModal').html(data);
                    $('#membershipModal').modal('show');
                });

        }

        function initMembershipTable() {
            $('#searchString').on('keyup', function (event) {
                if (event.key === "Enter") {
                    globalTableData.api().ajax.reload();
                }
            });

            var table = $("#MydataTableDiv").dataTable({
                "lengthChange": false, 
                "pageLength": 20,
                "searching": false,
                "bProcessing": false,
                "bSort": true,
                "sPaginationType": "full_numbers",
                "bServerSide": false,
                "sAjaxSource": "/Memberships/GetMembershipsList",
                "fnServerData": function (sSource, aoData, fnCallback) {
                    $.ajax({
                        "dataType": 'json',
                        "type": "Get",
                        "url": sSource,
                        "data": { "searchString": $("#searchString").val() },
                        "success": function (json) {
                            fnCallback(JSON.parse(json));
                        }
                    })
                },
                "aoColumns": [
                    { "mData": "Rank" },
                    { "mData": "Tier" },
                    { "mData": "Status" },
                    { "mData": "action" },
                    { "mData": "Id" }
                ],
                "aoColumnDefs": [
                    {
                        "aTargets": [2],
                        "mRender": function (data, type, row) {
                            if (data == true) {
                                var actions = '<span class="badge bg-label-primary me-1">Active</span>'
                                return actions;
                            }
                            else {
                                var actions = '<span class="badge bg-label-warning me-1">Inactive</span>'
                                return actions;

                            }
                        },
                    },
                    {
                        "aTargets": [-2],
                        "visible": true,
                        "searchable": false,
                        "mRender": function (data, type, row) {
                            var action = '<div class="dropdown"><button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown"><i class="bx bx-dots-vertical-rounded"></i></button><div class="dropdown-menu"><a class="dropdown-item" onclick="EditMemberShips(\'' + row.Id + '\')";"><i class="bx bx-edit-alt me-1"></i> Edit</a><a class="dropdown-item" href="javascript:void(0);"><i class="bx bx-trash me-1"></i> Delete</a></div></div>';
                            return action;
                        }
                    },
                    {
                        "aTargets": [-1],
                        "visible": false,
                        "searchable": false
                    },
                ],
                "order": [[1, "asc"]],
            });

            $("#MydataTableDiv_filter").css("float", "right");
            $("#MydataTableDiv_paginate").css("float", "right");
            $("#MydataTableDiv_length").find("label").css("display", "flex");
            $("#MydataTableDiv_length").find("label").css("align-items", "center");
            $("#MydataTableDiv_length").find("select").css("width", "55px");
            $("#MydataTableDiv_length").find("select").css("margin", "5px");
            $("#MydataTableDiv_filter").find("label").css("display", "flex");
            $("#MydataTableDiv_filter").find("label").css("align-items", "center");
            $("#MydataTableDiv_filter").css("float", "right");
            $("#MydataTableDiv_filter").find("input").css("margin", "5px");
            $("#MydataTableDiv_filter").find("input").css("margin-right", "0px");

            $('#btnsearch').on('click', function () {
                table.api().ajax.reload();
            });

            globalTableData = table;

            // $(function () {
            //     $('#memberGroupFilterForm').each(function () {
            //         $(this).find('input').keypress(function (e) {
            //             if (e.which == 10 || e.which == 13) {
            //                 $('#btnsearch').click();
            //             }
            //         });
            //     });
            // });
      }

        $(document).ready(function () {
            initMembershipTable()
        })
    </script>
}
